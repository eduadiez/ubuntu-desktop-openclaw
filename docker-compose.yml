services:
  mate-desktop:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: mate-desktop
    hostname: mate-desktop
    restart: unless-stopped
    ports:
      - "${NOVNC_PORT:-6080}:6080"   # noVNC (browser access)
      - "${VNC_PORT:-5900}:5900"     # VNC direct access (optional)
    environment:
      - VNC_PASSWORD=${VNC_PASSWORD:-dappnode}
      - VNC_RESOLUTION=${VNC_RESOLUTION:-1920x1080}
      - VNC_COL_DEPTH=${VNC_COL_DEPTH:-24}
      - TZ=${TZ:-UTC}
    volumes:
      - desktop-home:/home/desktop   # Persistent home directory
    shm_size: "2gb"                  # Needed for browser/desktop apps
    healthcheck:
      test: ["CMD", "pgrep", "-x", "websockify"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    # Uncomment for GPU access if needed:
    # devices:
    #   - /dev/dri:/dev/dri

volumes:
  desktop-home:
    name: mate-desktop-home
